{"version":3,"sources":["../src/index.jsx"],"names":["Geocoder","state","results","focus","loading","searchTime","Date","value","onInput","bind","onKeyDown","clickOption","onResult","onChange","onSelect","focusOnMount","props","input","target","setState","e","endpoint","source","accessToken","proximity","bbox","types","query","which","preventDefault","moveFocus","length","acceptFocus","body","oldSearchTime","onSuggest","features","place","text","dir","Math","max","min","listLocation","inputClass","inputPlaceholder","inputPosition","showLoader","resultsClass","resultClass","resultFocusClass","CustomResultList","ResultList","CustomResult","Result","CustomResultLink","ResultLink","CustomInputWrapper","InputWrapper","CustomSearchIcon","SeachIcon","CustomInput","Input","CustomWrapper","Wraapper","Components","SearchIcon","Wrapper","ref","map","result","i","id","place_name","Component","propTypes","PropTypes","string","isRequired","element","bool","func","arrayOf","number","defaultProps"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;MAiBqBA,Q;;;AACnB,wBAAc;AAAA;;AAAA;;AAGZ,YAAKC,KAAL,GAAa;AACXC,iBAAS,EADE;AAEXC,eAAO,IAFI;AAGXC,iBAAS,KAHE;AAIXC,oBAAY,IAAIC,IAAJ,EAJD;AAKXC,eAAO;AALI,OAAb;;AAQA,YAAKC,OAAL,GAAe,MAAKA,OAAL,CAAaC,IAAb,OAAf;AACA,YAAKC,SAAL,GAAiB,MAAKA,SAAL,CAAeD,IAAf,OAAjB;AACA,YAAKE,WAAL,GAAmB,MAAKA,WAAL,CAAiBF,IAAjB,OAAnB;AACA,YAAKG,QAAL,GAAgB,MAAKA,QAAL,CAAcH,IAAd,OAAhB;AACA,YAAKI,QAAL,GAAgB,MAAKA,QAAL,CAAcJ,IAAd,OAAhB;AACA,YAAKK,QAAL,GAAgB,MAAKA,QAAL,CAAcL,IAAd,OAAhB;AAhBY;AAiBb;;;;0CAEmB;AAAA,YACVM,YADU,GACO,KAAKC,KADZ,CACVD,YADU;;AAElB,YAAIA,YAAJ,EAAkB,KAAKE,KAAL,CAAWd,KAAX;AACnB;;;qCAEoB;AAAA,YAAVe,MAAU,QAAVA,MAAU;;AACnB,aAAKC,QAAL,CAAc;AACZZ,iBAAOW,OAAOX;AADF,SAAd;AAGD;;;8BAEOa,C,EAAG;AACT,aAAKD,QAAL,CAAc,EAAEf,SAAS,IAAX,EAAd;AADS,YAEDG,KAFC,GAESa,EAAEF,MAFX,CAEDX,KAFC;;AAGT,YAAIA,UAAU,EAAd,EAAkB;AAChB,eAAKY,QAAL,CAAc;AACZjB,qBAAS,EADG;AAEZC,mBAAO,IAFK;AAGZC,qBAAS;AAHG,WAAd;AAKD,SAND,MAMO;AAAA,uBAQD,KAAKY,KARJ;AAAA,cAEHK,QAFG,UAEHA,QAFG;AAAA,cAGHC,MAHG,UAGHA,MAHG;AAAA,cAIHC,WAJG,UAIHA,WAJG;AAAA,cAKHC,SALG,UAKHA,SALG;AAAA,cAMHC,IANG,UAMHA,IANG;AAAA,cAOHC,KAPG,UAOHA,KAPG;;;AAUL,gCAAO;AACLL,8BADK;AAELC,0BAFK;AAGLC,oCAHK;AAILC,gCAJK;AAKLC,sBALK;AAMLC,wBANK;AAOLC,mBAAOpB,KAPF;AAQLK,sBAAU,KAAKA;AARV,WAAP;AAUD;AACF;;;gCAESQ,C,EAAG;AAAA,qBACgB,KAAKnB,KADrB;AAAA,YACHC,OADG,UACHA,OADG;AAAA,YACMC,KADN,UACMA,KADN;;AAEX,gBAAQiB,EAAEQ,KAAV;AACE;AACA,eAAK,EAAL;AACER,cAAES,cAAF;AACA,iBAAKC,SAAL,CAAe,CAAC,CAAhB;AACA;AACF;AACA,eAAK,EAAL;AACE,iBAAKA,SAAL,CAAe,CAAf;AACA;AACF;AACA,eAAK,EAAL;AACE,gBAAI5B,QAAQ6B,MAAR,GAAiB,CAAjB,IAAsB5B,SAAS,IAAnC,EAAyC;AACvC,mBAAKQ,WAAL,CAAiBT,QAAQ,CAAR,CAAjB,EAA6B,CAA7B;AACD;AACD,iBAAK8B,WAAL;AACA;AACF;AACE;AAlBJ;AAoBD;;;+BAEQC,I,EAAM5B,U,EAAY;AAAA,sBACsB,KAAKJ,KAD3B;AAAA,YACLiC,aADK,WACjB7B,UADiB;AAAA,YACUH,OADV,WACUA,OADV;AAAA,YAEjBiC,SAFiB,GAEH,KAAKnB,KAFF,CAEjBmB,SAFiB;;;AAIzB;AACA;AACA;AACA,YAAIF,QAAQA,KAAKG,QAAb,IAAyBF,iBAAiB7B,UAA9C,EAA0D;AACxD,eAAKc,QAAL,CAAc;AACZd,kCADY;AAEZD,qBAAS,KAFG;AAGZF,qBAAS+B,KAAKG,QAHF;AAIZjC,mBAAO;AAJK,WAAd;AAMAgC,oBAAUjC,OAAV;AACD;AACF;;;+BAEQmC,K,EAAO;AAAA,YACNvB,QADM,GACO,KAAKE,KADZ,CACNF,QADM;;;AAGd,aAAKK,QAAL,CAAc;AACZZ,iBAAO,EADK;AAEZL,mBAAS;AAFG,SAAd;;AAKAY,iBAASuB,KAAT;AACD;;;+BAEQC,I,EAAM;AACb,aAAKnB,QAAL,CAAc;AACZZ,iBAAO+B;AADK,SAAd;AAGD;;;gCAESC,G,EAAK;AAAA,sBACuB,KAAKtC,KAD5B;AAAA,YACLG,OADK,WACLA,OADK;AAAA,YACID,KADJ,WACIA,KADJ;AAAA,YACWD,OADX,WACWA,OADX;;AAEb,YAAIE,OAAJ,EAAa;AACb,aAAKe,QAAL,CAAc;AACZhB,iBAAOA,UAAU,IAAV,GACH,CADG,GACCqC,KAAKC,GAAL,CAAS,CAAT,EACJD,KAAKE,GAAL,CACExC,QAAQ6B,MAAR,GAAiB,CADnB,EAEE5B,QAAQoC,GAFV,CADI;AAFI,SAAd;AAQD;;;oCAEa;AAAA,sBACe,KAAKtC,KADpB;AAAA,YACJE,KADI,WACJA,KADI;AAAA,YACGD,OADH,WACGA,OADH;AAAA,YAEJY,QAFI,GAES,KAAKE,KAFd,CAEJF,QAFI;;;AAIZ,YAAIX,UAAU,IAAd,EAAoB;AAClB,eAAKW,QAAL,CAAcZ,QAAQC,KAAR,CAAd;AACD;AACF;;;kCAEWkC,K,EAAOM,Y,EAAc;AAAA,YACvB7B,QADuB,GACV,KAAKE,KADK,CACvBF,QADuB;;;AAG/B,aAAKA,QAAL,CAAcuB,KAAd;AACA,aAAKlB,QAAL,CAAc,EAAEhB,OAAOwC,YAAT,EAAd;;AAEA;AACA;AACA;AACA,eAAO,KAAP;AACD;;;+BAEQ;AAAA;;AAAA,sBAgBH,KAAK3B,KAhBF;AAAA,YAEL4B,UAFK,WAELA,UAFK;AAAA,YAGLC,gBAHK,WAGLA,gBAHK;AAAA,YAILC,aAJK,WAILA,aAJK;AAAA,YAKLC,UALK,WAKLA,UALK;AAAA,YAMLC,YANK,WAMLA,YANK;AAAA,YAOLC,WAPK,WAOLA,WAPK;AAAA,YAQLC,gBARK,WAQLA,gBARK;AAAA,YASOC,gBATP,WASLC,UATK;AAAA,YAUGC,YAVH,WAULC,MAVK;AAAA,YAWOC,gBAXP,WAWLC,UAXK;AAAA,YAYSC,kBAZT,WAYLC,YAZK;AAAA,YAaMC,gBAbN,WAaLC,SAbK;AAAA,YAcEC,WAdF,WAcLC,KAdK;AAAA,YAeKC,aAfL,WAeLC,QAfK;AAAA,sBAuBH,KAAK/D,KAvBF;AAAA,YAmBLC,OAnBK,WAmBLA,OAnBK;AAAA,YAoBLE,OApBK,WAoBLA,OApBK;AAAA,YAqBLD,KArBK,WAqBLA,KArBK;AAAA,YAsBLI,KAtBK,WAsBLA,KAtBK;;;AAyBP,YAAM0D,aAAa;AACjBb,sBAAYD,oBAAoBC,kBADf;AAEjBE,kBAAQD,gBAAgBC,cAFP;AAGjBE,sBAAYD,oBAAoBC,kBAHf;AAIjBE,wBAAcD,sBAAsBC,oBAJnB;AAKjBQ,sBAAYP,oBAAoBO,kBALf;AAMjBJ,iBAAOD,eAAeC,aANL;AAOjBK,mBAASJ,iBAAiBI;AAPT,SAAnB;;AAUA,YAAMlD,QACJ;AAAC,oBAAD,CAAY,YAAZ;AAAA;AACE,wCAAC,UAAD,CAAY,UAAZ,OADF;AAEE,wCAAC,UAAD,CAAY,KAAZ;AACE,sBAAU,kBAACmD,GAAD,EAAS;AAAE,qBAAKnD,KAAL,GAAamD,GAAb;AAAmB,aAD1C;AAEE,uBAAWxB,UAFb;AAGE,qBAAS,KAAKpC,OAHhB;AAIE,uBAAW,KAAKE,SAJlB;AAKE,sBAAU,KAAKG,QALjB;AAME,yBAAagC,gBANf;AAOE,kBAAK,MAPP;AAQE,mBAAOtC;AART;AAFF,SADF;;AAgBA,eACE;AAAC,oBAAD,CAAY,OAAZ;AAAA;AACGuC,4BAAkB,KAAlB,IAA2B7B,KAD9B;AAEE;AAAC,sBAAD,CAAY,UAAZ;AAAA,cAAuB,iCACf8B,cAAc3C,OAAd,GACJ,SADI,GAEJ,EAHmB,yBAKf4C;AALR;AAOG9C,oBAAQ6B,MAAR,GAAiB,CAAjB,IACC7B,QAAQmE,GAAR,CAAY,UAACC,MAAD,EAASC,CAAT;AAAA,qBACV;AAAC,0BAAD,CAAY,MAAZ;AAAA,kBAAmB,KAAKD,OAAOE,EAA/B;AACE;AAAC,4BAAD,CAAY,UAAZ;AAAA;AACE,0BAAK,QADP;AAEE,6BAAS;AAAA,6BAAM,OAAK7D,WAAL,CAAiB2D,MAAjB,EAAyBC,CAAzB,CAAN;AAAA,qBAFX;AAGE,+BAActB,WAAd,UAA6BsB,MAAMpE,KAAN,GAAc+C,gBAAd,GAAiC,EAA9D,CAHF;AAIE,yBAAKoB,OAAOE;AAJd;AAMGF,yBAAOG;AANV;AADF,eADU;AAAA,aAAZ;AARJ,WAFF;AAwBG3B,4BAAkB,QAAlB,IAA8B7B;AAxBjC,SADF;AA4BD;;;;IA3OmCyD,gB;;oBAAjB1E,Q;;;AA8OrBA,WAAS2E,SAAT,GAAqB;AACnBtD,cAAUuD,oBAAUC,MADD;AAEnBvD,YAAQsD,oBAAUC,MAFC;AAGnBtD,iBAAaqD,oBAAUC,MAAV,CAAiBC,UAHX;;AAKnBlC,gBAAYgC,oBAAUC,MALH;AAMnB5B,iBAAa2B,oBAAUC,MANJ;AAOnB7B,kBAAc4B,oBAAUC,MAPL;AAQnB3B,sBAAkB0B,oBAAUC,MART;;AAUnBzB,gBAAYwB,oBAAUG,OAVH;AAWnBzB,YAAQsB,oBAAUG,OAXC;AAYnBvB,gBAAYoB,oBAAUG,OAZH;AAanBrB,kBAAckB,oBAAUG,OAbL;AAcnBnB,eAAWgB,oBAAUG,OAdF;AAenBjB,WAAOc,oBAAUG,OAfE;AAgBnBf,cAAUY,oBAAUG,OAhBD;;AAkBnBhC,gBAAY6B,oBAAUI,IAlBH;AAmBnBjE,kBAAc6D,oBAAUI,IAnBL;;AAqBnBlC,mBAAe8B,oBAAUC,MArBN;AAsBnBhC,sBAAkB+B,oBAAUC,MAtBT;;AAwBnB/D,cAAU8D,oBAAUK,IAAV,CAAeH,UAxBN;AAyBnB3C,eAAWyC,oBAAUK,IAzBF;;AA2BnBzD,eAAWoD,oBAAUC,MA3BF;AA4BnBpD,UAAMmD,oBAAUM,OAAV,CAAkBN,oBAAUO,MAA5B,CA5Ba;;AA8BnBzD,WAAOkD,oBAAUC;AA9BE,GAArB;;AAiCA7E,WAASoF,YAAT,GAAwB;AACtB/D,cAAU,8BADY;;AAGtBuB,gBAAY,EAHU;AAItBK,iBAAa,EAJS;AAKtBD,kBAAc,EALQ;AAMtBE,sBAAkB,QANI;;AAQtBE,gBAAY,IARU;AAStBE,YAAQ,IATc;AAUtBE,gBAAY,IAVU;AAWtBE,kBAAc,IAXQ;AAYtBE,eAAW,IAZW;AAatBE,WAAO,IAbe;AActBE,cAAU,IAdY;;AAgBtBlB,mBAAe,KAhBO;;AAkBtBD,sBAAkB,QAlBI;;AAoBtBE,gBAAY,KApBU;;AAsBtBzB,YAAQ,eAtBc;AAuBtBE,eAAW,EAvBW;;AAyBtBC,UAAM,EAzBgB;AA0BtBC,WAAO,EA1Be;;AA4BtBS,eAAW;AAAA,aAAM,IAAN;AAAA,KA5BW;AA6BtBpB,kBAAc;AA7BQ,GAAxB","file":"index.js","sourcesContent":["import 'babel-polyfill';\n\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\n\nimport search from './search';\n\nimport {\n  Input,\n  InputWrapper,\n  SearchIcon,\n  ResultList,\n  Result,\n  ResultLink,\n  Wrapper,\n} from './styles';\n\nexport default class Geocoder extends Component {\n  constructor() {\n    super();\n\n    this.state = {\n      results: [],\n      focus: null,\n      loading: false,\n      searchTime: new Date(),\n      value: '',\n    };\n\n    this.onInput = this.onInput.bind(this);\n    this.onKeyDown = this.onKeyDown.bind(this);\n    this.clickOption = this.clickOption.bind(this);\n    this.onResult = this.onResult.bind(this);\n    this.onChange = this.onChange.bind(this);\n    this.onSelect = this.onSelect.bind(this);\n  }\n\n  componentDidMount() {\n    const { focusOnMount } = this.props;\n    if (focusOnMount) this.input.focus();\n  }\n\n  onChange({ target }) {\n    this.setState({\n      value: target.value,\n    });\n  }\n\n  onInput(e) {\n    this.setState({ loading: true });\n    const { value } = e.target;\n    if (value === '') {\n      this.setState({\n        results: [],\n        focus: null,\n        loading: false,\n      });\n    } else {\n      const {\n        endpoint,\n        source,\n        accessToken,\n        proximity,\n        bbox,\n        types,\n      } = this.props;\n\n      search({\n        endpoint,\n        source,\n        accessToken,\n        proximity,\n        bbox,\n        types,\n        query: value,\n        onResult: this.onResult,\n      });\n    }\n  }\n\n  onKeyDown(e) {\n    const { results, focus } = this.state;\n    switch (e.which) {\n      // up\n      case 38:\n        e.preventDefault();\n        this.moveFocus(-1);\n        break;\n      // down\n      case 40:\n        this.moveFocus(1);\n        break;\n      // accept\n      case 13:\n        if (results.length > 0 && focus == null) {\n          this.clickOption(results[0], 0);\n        }\n        this.acceptFocus();\n        break;\n      default:\n        break;\n    }\n  }\n\n  onResult(body, searchTime) {\n    const { searchTime: oldSearchTime, results } = this.state;\n    const { onSuggest } = this.props;\n\n    // searchTime is compared with the last search to set the state\n    // to ensure that a slow xhr response does not scramble the\n    // sequence of autocomplete display.\n    if (body && body.features && oldSearchTime <= searchTime) {\n      this.setState({\n        searchTime,\n        loading: false,\n        results: body.features,\n        focus: null,\n      });\n      onSuggest(results);\n    }\n  }\n\n  onSelect(place) {\n    const { onSelect } = this.props;\n\n    this.setState({\n      value: '',\n      results: [],\n    });\n\n    onSelect(place);\n  }\n\n  setInput(text) {\n    this.setState({\n      value: text,\n    });\n  }\n\n  moveFocus(dir) {\n    const { loading, focus, results } = this.state;\n    if (loading) return;\n    this.setState({\n      focus: focus === null\n        ? 0 : Math.max(0,\n          Math.min(\n            results.length - 1,\n            focus + dir,\n          )),\n    });\n  }\n\n  acceptFocus() {\n    const { focus, results } = this.state;\n    const { onSelect } = this.props;\n\n    if (focus !== null) {\n      this.onSelect(results[focus]);\n    }\n  }\n\n  clickOption(place, listLocation) {\n    const { onSelect } = this.props;\n\n    this.onSelect(place);\n    this.setState({ focus: listLocation });\n\n    // focus on the input after click to maintain key traversal\n    // this line doesn't work\n    // this.input.focus();\n    return false;\n  }\n\n  render() {\n    const {\n      inputClass,\n      inputPlaceholder,\n      inputPosition,\n      showLoader,\n      resultsClass,\n      resultClass,\n      resultFocusClass,\n      ResultList: CustomResultList,\n      Result: CustomResult,\n      ResultLink: CustomResultLink,\n      InputWrapper: CustomInputWrapper,\n      SeachIcon: CustomSearchIcon,\n      Input: CustomInput,\n      Wraapper: CustomWrapper,\n    } = this.props;\n\n    const {\n      results,\n      loading,\n      focus,\n      value,\n    } = this.state;\n\n    const Components = {\n      ResultList: CustomResultList || ResultList,\n      Result: CustomResult || Result,\n      ResultLink: CustomResultLink || ResultLink,\n      InputWrapper: CustomInputWrapper || InputWrapper,\n      SearchIcon: CustomSearchIcon || SearchIcon,\n      Input: CustomInput || Input,\n      Wrapper: CustomWrapper || Wrapper,\n    };\n\n    const input = (\n      <Components.InputWrapper>\n        <Components.SearchIcon />\n        <Components.Input\n          innerRef={(ref) => { this.input = ref; }}\n          className={inputClass}\n          onInput={this.onInput}\n          onKeyDown={this.onKeyDown}\n          onChange={this.onChange}\n          placeholder={inputPlaceholder}\n          type=\"text\"\n          value={value}\n        />\n      </Components.InputWrapper>\n    );\n\n    return (\n      <Components.Wrapper>\n        {inputPosition === 'top' && input}\n        <Components.ResultList className={`\n              ${showLoader && loading\n          ? 'loading'\n          : ''\n              }\n              ${resultsClass}`}\n        >\n          {results.length > 0 && (\n            results.map((result, i) => (\n              <Components.Result key={result.id}>\n                <Components.ResultLink\n                  type=\"button\"\n                  onClick={() => this.clickOption(result, i)}\n                  className={`${resultClass} ${i === focus ? resultFocusClass : ''}`}\n                  key={result.id}\n                >\n                  {result.place_name}\n                </Components.ResultLink>\n              </Components.Result>\n            ))\n          )}\n        </Components.ResultList>\n        {inputPosition === 'bottom' && input}\n      </Components.Wrapper>\n    );\n  }\n}\n\nGeocoder.propTypes = {\n  endpoint: PropTypes.string,\n  source: PropTypes.string,\n  accessToken: PropTypes.string.isRequired,\n\n  inputClass: PropTypes.string,\n  resultClass: PropTypes.string,\n  resultsClass: PropTypes.string,\n  resultFocusClass: PropTypes.string,\n\n  ResultList: PropTypes.element,\n  Result: PropTypes.element,\n  ResultLink: PropTypes.element,\n  InputWrapper: PropTypes.element,\n  SeachIcon: PropTypes.element,\n  Input: PropTypes.element,\n  Wraapper: PropTypes.element,\n\n  showLoader: PropTypes.bool,\n  focusOnMount: PropTypes.bool,\n\n  inputPosition: PropTypes.string,\n  inputPlaceholder: PropTypes.string,\n\n  onSelect: PropTypes.func.isRequired,\n  onSuggest: PropTypes.func,\n\n  proximity: PropTypes.string,\n  bbox: PropTypes.arrayOf(PropTypes.number),\n\n  types: PropTypes.string,\n};\n\nGeocoder.defaultProps = {\n  endpoint: 'https://api.tiles.mapbox.com',\n\n  inputClass: '',\n  resultClass: '',\n  resultsClass: '',\n  resultFocusClass: 'strong',\n\n  ResultList: null,\n  Result: null,\n  ResultLink: null,\n  InputWrapper: null,\n  SeachIcon: null,\n  Input: null,\n  Wraapper: null,\n\n  inputPosition: 'top',\n\n  inputPlaceholder: 'Search',\n\n  showLoader: false,\n\n  source: 'mapbox.places',\n  proximity: '',\n\n  bbox: [],\n  types: '',\n\n  onSuggest: () => null,\n  focusOnMount: true,\n};\n"]}